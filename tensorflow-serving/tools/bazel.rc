# Optimizations used for TF Serving release builds.
build:release --copt=-mavx
build:release --copt=-msse4.2

# Options used to build with CUDA.
build:cuda --crosstool_top=@local_config_cuda//crosstool:toolchain
build:cuda --define=using_cuda=true --define=using_cuda_nvcc=true

# Please note that MKL on MacOS or windows is still not supported.
# If you would like to use a local MKL instead of downloading, please set the
# environment variable "TF_MKL_ROOT" every time before build.
build:mkl --define=using_mkl=true

# This config option is used to enable MKL-DNN open source library only,
# without depending on MKL binary version.
build:mkl_open_source_only --define=using_mkl_dnn_only=true

# Processor native optimizations (depends on build host capabilities).
build:nativeopt --copt=-march=native
build:nativeopt --host_copt=-march=native
build:nativeopt --copt=-O3

# Options for crossbuilding to armv7-a
build:armv7-a --crosstool_top=//tools/cpp/arm:toolchain
build:armv7-a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain
build:armv7-a --cpu=armeabi
build:armv7-a --copt=-march=armv7-a
build:armv7-a --copt=-O3
build:armv7-a --copt=-DARM_NON_MOBILE
build:armv7-a --copt=-DRASPBERRY_PI
build:armv7-a --define LIBEVENT_HOST=arm-linux-gnueabihf
build:armv7-a --define LIBEVENT_MARCH=-march=armv7-a

# Options for crossbuilding to armv8-a
build:armv8-a --crosstool_top=//tools/cpp/arm:toolchain
build:armv8-a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain
build:armv8-a --cpu=aarch64
build:armv8-a --copt=-march=armv8-a
build:armv8-a --copt=-O3
build:armv8-a --copt=-DARM_NON_MOBILE
build:armv8-a --copt=-DRASPBERRY_PI
build:armv8-a --define LIBEVENT_HOST=aarch64-linux-gnu
build:armv8-a --define LIBEVENT_MARCH=-march=armv8-a

build --action_env PYTHON_BIN_PATH="/usr/bin/python"
build --define PYTHON_BIN_PATH=/usr/bin/python

build --spawn_strategy=standalone
build --genrule_strategy=standalone

build --define=grpc_no_ares=true

build -c opt

# Adding --cxxopt=-D_GLIBCXX_USE_CXX11_ABI=0" creates parity with TF
# compilation options. It also addresses memory use due to
# copy-on-write semantics of std::strings of the older ABI.
build --cxxopt=-D_GLIBCXX_USE_CXX11_ABI=0

build --workspace_status_command=/proc/self/cwd/tools/gen_status_stamp.sh
